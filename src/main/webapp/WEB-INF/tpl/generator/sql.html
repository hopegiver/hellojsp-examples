<!-- IF START 'FRAMESET_BLOCK' -->
<script language="javascript" type="text/javascript" src="../js/common.jsp"></script>
<script> 
try { 
	addEvent("onload", function() {
		try {
			parent.LIST.toggleBackground("{{table}}");
			SetCookie("PREPAGE", document.URL, "", "/");
		} catch(e) {}
    });
} catch(e) {}
</script>
<frameset rows="40%,*" frameborder="1" border="5" bordercolor="#eeeeee">
	<frame src="sql.jsp?schema={{schema}}&mode=SQL&table={{table}}" name="SQL" id="SQL" scrolling="no"></frame>
	<frame src="sql.jsp?schema={{schema}}&mode=RESULT&table={{table}}" name="RESULT" id="RESULT" scrolling="no"></frame>
</frameset>
<!-- IF END 'FRAMESET_BLOCK' -->


<!-- IF START 'SQL_BLOCK' -->
<div class="tabs" style="float:left;height:23px;margin-bottom:5px;position:relative;">
	<div style="position:absolute;width:100%;height:1px;top:22px;border-top:1px solid #91A7B4;overflow:hidden"></div>
	<div style="position:absolute;">
		<ul style="float:left;">
			<li><span><a href="schema.jsp?schema={{schema}}&table={{table}}" target="_parent">Schema</a></span></li>
			<li><span><a href="data.jsp?schema={{schema}}&table={{table}}" target="_parent">Data</a></span></li>
			<li class="current"><span><a href="sql.jsp?schema={{schema}}&table={{table}}" target="_parent">SQL</a></span></li>
			<li><span><a href="ddl.jsp?schema={{schema}}&table={{table}}" target="_parent">DDL</a></span></li>
			<li><span><a href="source.jsp?schema={{schema}}&table={{table}}" target="_parent">Generate</a></span></li>
		</ul>
	</div>
	<div class="nm01">{{table}}</div>
</div>
<div style="clear:both;"></div>

<div class="tabs2" style="float:left;height:23px;margin-top:5px;margin-bottom:5px;position:relative;">
	<div style="position:absolute;width:100%;height:1px;top:22px;border-top:1px solid #91A7B4;overflow:hidden"></div>
	<div style="position:absolute;">
		<ul style="float:left;">
			<li id="tab1"><span><a href="javascript:tabManager('1')" onfocus="this.blur()">Worksheet1</a></span></li>
			<li id="tab2"><span><a href="javascript:tabManager('2')" onfocus="this.blur()">Worksheet2</a></span></li>
			<li id="tab3"><span><a href="javascript:tabManager('3')" onfocus="this.blur()">Worksheet3</a></span></li>
			<li id="tab4"><span><a href="javascript:tabManager('4')" onfocus="this.blur()">Worksheet4</a></span></li>
		</ul>
	</div>
	<div style="float:right;font-family:dotum;font-size:11px;">
		조회쿼리 시 결과 수 
		<select name="ln" id="ln" onchange="SetCookie('sql_ln', this.value)">
			<option value="50">50</option>
			<option value="100">100</option>
			<option value="200">200</option>
			<option value="500">500</option>
			<option value="1000">1000</option>
		</select>
		<script>
		SetElementValue(document.getElementById("ln"), GetCookie("sql_ln") ? GetCookie("sql_ln") : 50);
		</script>
		<input type="button" value="실행(Ctrl + Enter)" class="btn01" onclick="goExecute()">
	</div>
</div>
<div style="clear:both;"></div>

<iframe name="SQLIFRM1" id="SQLIFRM1" src="sql.jsp?mode=SQLIFRM&table={{table}}&type=1" frameborder="0" width="100%" scrolling="no" style="display:none"></iframe>
<iframe name="SQLIFRM2" id="SQLIFRM2" src="sql.jsp?mode=SQLIFRM&table={{table}}&type=2" frameborder="0" width="100%" scrolling="no" style="display:none"></iframe>
<iframe name="SQLIFRM3" id="SQLIFRM3" src="sql.jsp?mode=SQLIFRM&table={{table}}&type=3" frameborder="0" width="100%" scrolling="no" style="display:none"></iframe>
<iframe name="SQLIFRM4" id="SQLIFRM4" src="sql.jsp?mode=SQLIFRM&table={{table}}&type=4" frameborder="0" width="100%" scrolling="no" style="display:none"></iframe>
<script>
var preId = "";
function tabManager(id) {
	try { 
		if(preId) {
			document.getElementById("tab" + preId).className = "";
			document.getElementById("SQLIFRM" + preId).style.display = "none";
		}
		document.getElementById("tab" + id).className = "current";
		document.getElementById("SQLIFRM" + id).style.display = "block";
		preId = id;
	} catch(e) {}
	setHeight(id);
}
tabManager("1");

function setHeight(id) {
	try { 
		var src = document.getElementById("SQLIFRM" + id);
		var h = document.body.offsetHeight - src.offsetTop;
		src.style.height = (h > 0 ? h : 100) + "px"; 
	} catch(e) {}

	try { eval("SQLIFRM" + preId + ".codeMirror.focus()"); } catch(e) {}
}
addEvent("onresize", function() { setHeight(preId); });
function goExecute() {
	eval("SQLIFRM" + preId + ".goSubmit()");
}
</script>
<!-- IF END 'SQL_BLOCK' -->


<!-- IF START 'SQLIFRM_BLOCK' -->
<form name="form1" method="post" target="RESULT" action="sql.jsp?mode=RESULT&table={{table}}" style="height:100%;">
<input type="hidden" name="ln" value="">
<textarea name="worksheet" id="worksheet">{{default}}</textarea>
<textarea name="sql" style="display:none"></textarea>
</form>
<link rel="stylesheet" href="../util/fileman/codemirror/lib/codemirror_sql.css">
<script src="../util/fileman/codemirror/lib/codemirror.js"></script>
<script src="../util/fileman/codemirror/mode/plsql/plsql.js"></script>
<style type="text/css">
.CodeMirror { border-width:0px; margin:0px; width:100%; height:100%; padding:0px; font-family:Courier New, dotum; font-size:14px; } 
.activeline {background: #f0fcff !important;}
</style> 
<script>
var codeMirror = CodeMirror.fromTextArea(document.getElementById("worksheet"), {
	mode: "text/x-plsql"
	, tabMode: "indent"
	, matchBrackets: true
});
</script>
<script>
if(window.addEventListener) document.body.addEventListener("keydown", captureKey, false);
else if(window.attachEvent) document.body.attachEvent("onkeydown", captureKey);
function captureKey(e) {
	if(e.ctrlKey && e.keyCode == 13) {
		goSubmit();
	}
}
function goSubmit() {
	var f = document.forms['form1'];
	f['ln'].value = parent.document.getElementById("ln").value;	
	f['worksheet'].value = codeMirror.getValue();
	f['sql'].value = codeMirror.getSelection() ? codeMirror.getSelection() : f['worksheet'].value;
	f.submit();
}
addEvent("onload", function() { try { codeMirror.focus(); } catch(e) {} } );
</script>
<!-- IF END 'SQLIFRM_BLOCK' -->


<!-- IF START 'RESULT_BLOCK' -->
<div style="padding:10px 10px 0 10px;">

<div class="tabs2" style="float:left;height:23px;margin-bottom:10px;position:relative;">
	<div style="position:absolute;width:100%;height:1px;top:22px;border-top:1px solid #91A7B4;overflow:hidden"></div>
	<div style="position:absolute;">
		<ul style="float:left;">
			<li id="tab1"><span><a href="javascript:tabManager('1')" onfocus="this.blur()">Result</a></span></li>
			<li id="tab2"><span><a href="javascript:tabManager('2')" onfocus="this.blur()">Message</a></span></li>
		</ul>
	</div>
</div>
<div style="clear:both;"></div>

<div id="area1" style="display:none;overflow:auto;width:100%;font-family:dotum;font-size:12px;">
<!-- LOOP START 'list' -->
	<p style="font-family:arial;color:gray">{{list.query}}</p>
	<!-- IF START 'list.type_list' -->
		<!-- IFNOT START 'list.errMsg' -->
		<table class="l_tb01" cellspacing="0" cellpadding="0">
		<tr>
			<td class="l_th01">No</td>
			<!-- LOOP START 'columns' -->
			<td class="l_th01" title="{{columns.column_name}}">{{columns.column_name}}</td>
			<!-- LOOP END 'columns' -->
		</tr>
		<!-- IF START 'sub' -->
		<!-- LOOP START 'sub' -->
		<tr onclick="toggleColor(this)">
			<td class="l_td01 dr01" align="center" bgcolor="#efefef">{{sub.__ord}}</td>
			<!-- LOOP START 'data' -->
			<td class="l_td01{{data.dr01}}"><nobr title="{{data.value_title}}">{{data.value_conv}}</nobr></td>
			<!-- LOOP END 'data' -->
		</tr>
		<!-- LOOP END 'sub' -->
		<!-- IF END 'sub' -->
		</table>
		<!-- IFNOT END 'list.errMsg' -->
		<!-- IF START 'list.errMsg' -->
		<p style="margin-top:10px;color:red">{{list.errMsg}}</p>
		<!-- IF END 'list.errMsg' -->
	<!-- IF END 'list.type_list' -->
	<!-- IFNOT START 'list.type_list' -->
	<p style="margin-top:10px;color:red">{{list.errMsg}}</p>
	<!-- IFNOT END 'list.type_list' -->

	<p style="height:30px"></p>
<!-- LOOP END 'list' -->
</div>
<div id="area2" style="display:none;overflow:auto;width:100%;font-family:dotum;font-size:12px;line-height:150%">
{{messages}}
</div>

</div>
<script>
function toggleColor(tr) {
	tr.style.backgroundColor = tr.style.backgroundColor == "" ? "#FFFFCE" : "";
}
var preId = "";
function tabManager(id) {
	try { 
		if(preId) {
			document.getElementById("tab" + preId).className = "";
			document.getElementById("area" + preId).style.display = "none";
		}
		document.getElementById("tab" + id).className = "current";
		document.getElementById("area" + id).style.display = "block";
		preId = id;
	} catch(e) {}
	setHeight(id);
}
tabManager("{{openId}}");

function setHeight(id) {
	try { 
		var src = document.getElementById("area" + id);
		var h = document.body.offsetHeight - src.offsetTop;
		src.style.height = (h > 0 ? h : 100) + "px"; 
	} catch(e) {}
}
addEvent("onresize", function() { setHeight(preId); });
</script>
<!-- IF END 'RESULT_BLOCK' -->